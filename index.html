<html>

<head>
  <title>ESP8266</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <link rel="stylesheet" href="docs/css/styles.css">
  <script src="https://kit.fontawesome.com/25025a0dd5.js" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
  </script>
  <script type="text/javascript" language="javascript">
    var mqtt;
    var reconnectTimeout = 2000;
    var host = "192.168.1.14"; //change this
    var port = 9001;

    function onConnect() {
      // Once a connection has been made, make a subscription and send a message.

      console.log("Connected ");
      //mqtt.subscribe("sensor1");
      message = new Paho.MQTT.Message("Hello World");
      message.destinationName = "ardu/I10";
      mqtt.send(message);
      mqtt.subscribe("#");
    }
    function MQTTconnect() {
      console.log("connecting to " + host + " " + port);
      mqtt = new Paho.MQTT.Client(host, port, "clientjs");
      var options = {
        timeout: 3,
        onSuccess: onConnect,
      };

      mqtt.connect(options); //connect
    }	 
  </script>
</head>

<body>
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.1/js/bootstrap.min.js" integrity="sha384-XEerZL0cuoUbHE4nZReLT7nx9gQrQreJekYhJD9WNWhH8nEW+0c5qq7aIo2Wl30J" crossorigin="anonymous"></script>
  <!-- Image and text -->
  
    <nav class="navbar navbar-dark bg-dark">
      <a class="navbar-brand" href="#">
        <img src="docs/images/logo.svg" width="40" height="40" class="d-inline-block align-top" alt="" loading="lazy">
        Universidad Don Bosco
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="#controlPanel">Panel de control <span class="sr-only">(current)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#carousel-plcs">Dispositivos</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#features">Info</a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="jumbotron jumbotron-fluid feature-box">
      <h1 class="text-warning">ESP8266</h1>
      <p class="lead">Interfaz para esp8266 capaz de controlar un led y un rele</p>
    </div>
    
  <section id="controlPanel">
    <div class="container-fluid feature-box">  
      <div class="row">
        <div class="col-lg-6 col-md-6 col-sm-12">
          <h2>Panel de control</h2>
          <div class="row">
            <div class="col-lg-3 col-md-3 col-sm-6">
              <a>I1 :</a>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <button type='button' onclick='OnOff("ON", "ardu/I01")' class="btn btn-outline-success">ON</button>
              <button type='button' onclick='OnOff("OFF", "ardu/I01")' class="btn btn-danger">OFF</button>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <a>I2:</a>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <button type='button' onclick='OnOff("ON", "ardu/I02")' class="btn btn-outline-success">ON</button>
              <button type='button' onclick='OnOff("OFF", "ardu/I02")' class="btn btn-danger">OFF</button>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <a>I3:</a>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <button type='button' onclick='OnOff("ON", "ardu/I03")' class="btn btn-outline-success">ON</button>
              <button type='button' onclick='OnOff("OFF", "ardu/I03")' class="btn btn-danger">OFF</button>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <a>I4:</a>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <button type='button' onclick='OnOff("ON", "ardu/I04")' class="btn btn-outline-success">ON</button>
              <button type='button' onclick='OnOff("OFF", "ardu/I04")' class="btn btn-danger">OFF</button>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <a>I5:</a>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <button type='button' onclick='OnOff("ON", "ardu/I05")' class="btn btn-outline-success">ON</button>
              <button type='button' onclick='OnOff("OFF", "ardu/I05")' class="btn btn-danger">OFF</button>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <a>I6:</a>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <button type='button' onclick='OnOff("ON", "ardu/I06")' class="btn btn-outline-success">ON</button>
              <button type='button' onclick='OnOff("OFF", "ardu/I06")' class="btn btn-danger">OFF</button>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <a>I7:</a>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <button type='button' onclick='OnOff("ON", "ardu/I07")' class="btn btn-outline-success">ON</button>
              <button type='button' onclick='OnOff("OFF", "ardu/I07")' class="btn btn-danger">OFF</button>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <a>I8:</a>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <button type='button' onclick='OnOff("ON", "ardu/I08")' class="btn btn-outline-success">ON</button>
              <button type='button' onclick='OnOff("OFF", "ardu/I08")' class="btn btn-danger">OFF</button>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <a>I9:</a>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <button type='button' onclick='OnOff("ON", "ardu/I09")' class="btn btn-outline-success">ON</button>
              <button type='button' onclick='OnOff("OFF", "ardu/I09")' class="btn btn-danger">OFF</button>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <a>I10: </a>
            </div>
            <div class="col-lg-3 col-md-3 col-sm-6">
              <button type='button' onclick='OnOff("ON", "ardu/I10")' class="btn btn-outline-success">ON</button>
              <button type='button' onclick='OnOff("OFF", "ardu/I10")' class="btn btn-danger">OFF</button>
            </div>
          </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-12">
          <h2>Estado</h2>
          <div class="row">
            
            <div class="col-lg-6 col-md-6">
              <a>I1:</a>
              <a id="I1">-</a>
            </div>
            <div class="col-lg-6 col-md-6">
              <a>I2:</a>
              <a id="I2">-</a>
            </div>
            <div class="col-lg-6 col-md-6">
              <a>I3:</a>
              <a id="I3">-</a>
            </div>
            <div class="col-lg-6 col-md-6">
              <a>I4:</a>
              <a id="I4">-</a>
            </div>
            <div class="col-lg-6 col-md-6">
              <a>I5:</a>
              <a id="I5">-</a>
            </div>
            <div class="col-lg-6 col-md-6">
              <a>I6:</a>
              <a id="I6">-</a>
            </div>
            <div class="col-lg-6 col-md-6">
              <a>I7:</a>
              <a id="I7">-</a>
            </div>
            <div class="col-lg-6 col-md-6">
              <a>I8:</a>
              <a id="I8">-</a>
            </div>
            <div class="col-lg-6 col-md-6">
              <a>I9:</a>
              <a id="I9">-</a>
            </div>
            <div class="col-lg-6 col-md-6">
              <a>I10:</a>
              <a id="I10">-</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>  
  <section id="carousel-plcs">
    <div id="carousel-PLC" class="carousel slide" data-ride="carousel">
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img class="plc-image" src="docs/images/s7-1200.svg" alt="">
        </div>
        <div class="carousel-item">
          <img class="plc-image" src="docs/images/logo.png" alt="">
        </div>
      </div>
      <a class="carousel-control-prev" href="#carousel-PLC" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon"></span>
      </a>
      <a class="carousel-control-next" href="#carousel-PLC" role="button" data-slide="next">
        <span class="carousel-control-next-icon"></span>
      </a>
    </div>
  </section>
      
  <div class="container-fluid body-container">
    <section id="features">
      <div class="row">
        <div class="feature-box col-lg-4">
          <i class="icon fas fa-wifi fa-4x"></i>
          <h3>ESP8266</h3>
          <p>Controlado usando Wemos D1 mini</p>  
        </div> 
        <div class="feature-box col-lg-4">
          <i class="icon fas fa-plug fa-4x"></i>
          <h3>S7-1200</h3>
          <p>Control de entradas de PLC</p>
        </div>
        <div class="feature-box col-lg-4">
          <i class="icon fas fa-rocket fa-4x"></i>
          <h3>Websockets</h3>
          <p>Respuesta inmediata haciendo uso de MQTT</p>
        </div>   
      </div>
    </section>
  </div>  
    <script>
      MQTTconnect();

      function OnOff(dato, I) {
        message = new Paho.MQTT.Message(dato);
        //message.destinationName = "ardu/I10";
        message.destinationName = I;
        mqtt.send(message);
      };

      function onMessageArrived(message) {
        
        if (message.destinationName == "ardu/I01") { //acá coloco el topic
          document.getElementById("I1").textContent = message.payloadString;
        }
        if (message.destinationName == "ardu/I02") { //acá coloco el topic
          document.getElementById("I2").textContent = message.payloadString;
        }
        if (message.destinationName == "ardu/I03") { //acá coloco el topic
          document.getElementById("I3").textContent = message.payloadString;
        }
        if (message.destinationName == "ardu/I04") { //acá coloco el topic
          document.getElementById("I4").textContent = message.payloadString;
        }
        if (message.destinationName == "ardu/I05") { //acá coloco el topic
          document.getElementById("I5").textContent = message.payloadString;
        }
        if (message.destinationName == "ardu/I06") { //acá coloco el topic
          document.getElementById("I6").textContent = message.payloadString;
        }
        if (message.destinationName == "ardu/I07") { //acá coloco el topic
          document.getElementById("I7").textContent = message.payloadString;
        }
        if (message.destinationName == "ardu/I08") { //acá coloco el topic
          document.getElementById("I8").textContent = message.payloadString;
        }
        if (message.destinationName == "ardu/I09") { //acá coloco el topic
          document.getElementById("I9").textContent = message.payloadString;
        }
        if (message.destinationName == "ardu/I10") { //acá coloco el topic
          document.getElementById("I10").textContent = message.payloadString;
        }
      };

      mqtt.onMessageArrived = onMessageArrived;
    </script>
</body>

</html>